<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>人员信息</title>
    <link rel="stylesheet" href="/demo/css/bootstrap.css">
    <link rel="stylesheet" href="/demo/css/bootstrap.min.css">
    <link rel="stylesheet" href="/demo/css/font-awesome.min.css">
    <link rel="stylesheet" href="/demo/css/ionicons.min.css">
    <link rel="stylesheet" href="/demo/css/AdminLTE.min.css">
    <link rel="stylesheet" href="/demo/css/list.css">
    <link rel="stylesheet" href="/demo/css/all.css">
    <link rel="StyleSheet" href="/demo/css/tablemove.css" />
    <link rel="stylesheet" href="/demo/css/AdminLTE.min.css">
    <link rel="stylesheet" href="/demo/css/bootstrap-table.min.css">
    <link rel="StyleSheet" href="/demo/css/tablemove.css" />
    <link rel="StyleSheet" href="/demo/css/treeview.css" />

    <script src="/demo/js/jquery.min.js"></script>
    <script src="/demo/js/bootstrap.min.js"></script>
    <script src="/demo/js/tableExport.min.js"></script>
    <script src="/demo/js/FileSaver.js"></script>
    <script src="/demo/js/bootstrap-table.min.js"></script>
    <script src="/demo/js/bootstrap-table-zh-CN.js"></script>
    <script src="/demo/js/bootstrap-table-export.min.js"></script>
    <script src="/demo/js/adminlte.min.js"></script>
    <!-- <script src="/demo/js/jquery-ui-1.10.0.custom.min.js"></script> -->

    <script type="text/javascript">

        $(function() {

            $.ajax({
                type : "POST",
                url : "/demo/code/getCodesBycdCls",
                dataType : "json",
                data : {
                    'cdCls' : 'CARDTYPE'
                },

                success : function(data) {
                    //$("select[class='eventtype']").empty();
                    for (var i = 0; i < data.length; i++) {
                        var obj = data[i];
                        $("#cardType").append("<option value='"+obj.cd+"'>" + obj.chnName + "</option>");
                    }

                },
                error : function(XMLHttpRequest, textStatus, errorThrown) {
                    console.log(XMLHttpRequest.status+"--"+XMLHttpRequest.readyState+"--"+textStatus);
                    alert("失败");
                }
            });
        })
    </script>

    <script type="text/javascript">
        $(function() {
            var data = {
                'cdCls' : 'IMAGETYPE'
            }
            $.ajax({
                type : "POST",
                url : "/demo/code/getCodesBycdCls",
                dataType : "json",
                data : data,

                success : function(data) {
                    //$("select[class='eventtype']").empty();
                    for (var i = 0; i < data.length; i++) {
                        var obj = data[i];
                        $("#imageType").append("<option value='"+obj.cd+"'>" + obj.chnName + "</option>");
                    }

                },
                error : function(XMLHttpRequest, textStatus, errorThrown) {
                    console.log(XMLHttpRequest.status+"-"+XMLHttpRequest.status+"-"+XMLHttpRequest.readyState);
                    alert("初始化code:IMAGETYPE失败");
                }
            });
        })
    </script>

    <script type="text/javascript">
        $(function() {
            var data = {
                'cdCls' : 'SEX'
            }
            $.ajax({
                type : "POST",
                url : "/demo/code/getCodesBycdCls",
                dataType : "json",
                data : data,

                success : function(data) {
                    //$("select[class='eventtype']").empty();
                    for (var i = 0; i < data.length; i++) {
                        var obj = data[i];
                        $("#i_sex").append("<option value='"+obj.cd+"'>" + obj.chnName + "</option>");
                        $("#sex").append("<option value='"+obj.cd+"'>" + obj.chnName + "</option>");
                    }

                },
                error : function(XMLHttpRequest, textStatus, errorThrown) {
                    console.log(XMLHttpRequest.status+"-"+XMLHttpRequest.status+"-"+XMLHttpRequest.readyState);
                    alert("初始化code:SEX失败");
                }
            });
        })
    </script>
    <script type="text/javascript">
        $(function() {
            window.DBpersonType = {};
            var data = {
                'cdCls' : 'PERSONTYPE'
            }
            $.ajax({
                type : "POST",
                url : "/demo/code/getCodesBycdCls",
                dataType : "json",
                data : data,

                success : function(data) {
                    //$("select[class='eventtype']").empty();

                    $("#q_personType").append("<option value=''> 默认</option>");
                    for (var i = 0; i < data.length; i++) {
                        var obj = data[i];
                        $("#i_personType").append("<option value='"+obj.cd+"'>" + obj.chnName + "</option>");
                        $("#personType").append("<option value='"+obj.cd+"'>" + obj.chnName + "</option>");
                        $("#q_personType").append("<option value='"+obj.cd+"'>" + obj.chnName + "</option>");
                        window.DBpersonType[obj.cd] = obj.chnName;
                    }

                },
                error : function(XMLHttpRequest, textStatus, errorThrown) {
                    console.log(XMLHttpRequest.status+"-"+XMLHttpRequest.status+"-"+XMLHttpRequest.readyState);
                    alert("初始化code:PERSONTYPE失败");
                }
            });
        })
    </script>

    <script type="text/javascript">
        $(function() {
            $('#InsertModal').on('hide.bs.modal ', function(e) {

                $("#InsertModal input[type='text']").val('');
            })
            $(".saveData").click(function() {
                var emplid = $("#emplid").val();
                var name = $("#name").val();
                var birthdate = $("#birthdate").val();
                var birthcountry = $("#birthcountry").val();
                var descr1 = $("#descr1").val();
                var nationalId = $("#nationalId").val();
                var phone = $("#phone").val();
                var emailAddr = $("#emailAddr").val();
                var personType = $("#personType").val();
                var cardNo = $("#cardNo").val();
                var photoUrl = $("#photoUrl").val();
                var facePhotoUrl = $("#facePhotoUrl").val();
                var deptid = $("#deptid").val();
                var sex = $("#sex").val();
                var personId = $("#personId").val();

                var data = {
                    'emplid' : emplid,
                    'name' : name,
                    'birthdate' : birthdate,
                    'birthcountry' : birthcountry,
                    'descr1' : descr1,
                    'nationalId' : nationalId,
                    'phone' : phone,
                    'emailAddr' : emailAddr,
                    'personType' : personType,
                    'cardNo' : cardNo,
                    'photoUrl' : photoUrl,
                    'facePhotoUrl' : facePhotoUrl,
                    'deptid' : deptid,
                    'sex' : sex,
                    'personId' : personId,
                };
                $.ajax({
                    type : "POST",
                    url : "/demo/person/updatePerson",
                    dataType : "json",
                    data : data,
                    success : function(result) {

                        alert(result.msg);
                        if (result.status == '0') {
                            $('#UpdateModal').modal('hide');
                            $("#table").bootstrapTable('refresh');
                        }
                    },
                    error : function(XMLHttpRequest, textStatus, errorThrown) {
                        console.log(XMLHttpRequest.status+"-"+XMLHttpRequest.status+"-"+XMLHttpRequest.readyState);
                        alert("修改人员失败");

                    }
                });
            });

            $(".insertCard").click(function() {
                var personId = $("#card_synIndex").val();
                var startDate = $("#startDate").val();
                var endDate = $("#endDate").val();
                var cardNo = $("#cardNo").val();
                var cardType = $("#cardType").val();

                var data = {
                    'personId' : personId,
                    'startDate' : startDate,
                    'endDate' : endDate,
                    'cardNo' : cardNo,
                    'cardType' : cardType
                }
                $.ajax({
                    type : "POST",
                    url : "/demo/person/addCard",
                    dataType : "json",
                    data : data,
                    success : function(result) {

                        alert(result.msg);
                        if (result.status == '0') {
                            $("#cp_oldcardNo").val(cardNo);
                            $("#cp_newcardNo").val(cardNo);
                            $('#InsertCard').modal('hide');
                            $("#table").bootstrapTable('refresh');
                        }
                    },
                    error : function(XMLHttpRequest, textStatus, errorThrown) {
                        console.log(XMLHttpRequest.status+"-"+XMLHttpRequest.status+"-"+XMLHttpRequest.readyState);
                        alert("添加卡号失败");

                    }
                });

            })

            $(".insertFace").click(function() {
                var personId = $("#face_personId").val();
                var faceData = $("#faceData").val();
                var imageType = $("#imageType").val();

                var data = {
                    'personId' : personId,
                    'faceData' : faceData,
                    'imageType' : imageType
                }
                $.ajax({
                    type : "POST",
                    url : "/demo/person/addFace",
                    dataType : "json",
                    data : data,
                    success : function(result) {
                        alert(result.msg.msg);
                        if (result.msg.status == "0") {
                            $("#cp_faceId").val(result.faceId);
                            $('#InsertFace').modal('hide');
                            $("#insertFaceModel").hide();
                            $("#table").bootstrapTable('refresh');
                        }
                    },
                    error : function(XMLHttpRequest, textStatus, errorThrown) {
                        console.log(XMLHttpRequest.status+"-"+XMLHttpRequest.status+"-"+XMLHttpRequest.readyState);
                        alert("添加人脸失败");
                    }
                });
            })

            $(".show_dept").click(function() {
                /* 打开部门的模态框 */
                $("#objectType").val('D');
                $('#departmentModel').modal('show');

            });
            $(".insertData").click(function() {
                var emplid = $("#i_emplid").val();
                var name = $("#i_name").val();
                var birthdate = $("#i_birthdate").val();
                var birthcountry = $("#i_birthcountry").val();
                var descr1 = $("#i_descr1").val();
                var nationalId = $("#i_nationalId").val();
                var phone = $("#i_phone").val();
                var emailAddr = $("#i_emailAddr").val();
                var personType = $("#i_personType").val();
                var cardNo = $("#i_cardNo").val();
                var deptid = $("#i_deptid").val();
                var sex = $("#i_sex").val();
                var photoUrl = $("#i_photoUrl").val();
                var facePhotoUrl = $("#i_facePhotoUrl").val();

                var data = {
                    'emplid' : emplid,
                    'name' : name,
                    'birthdate' : birthdate,
                    'birthcountry' : birthcountry,
                    'descr1' : descr1,
                    'nationalId' : nationalId,
                    'phone' : phone,
                    'emailAddr' : emailAddr,
                    'personType' : personType,
                    'cardNo' : cardNo,
                    'deptid' : deptid,
                    'sex' : sex,
                    'photoUrl' : photoUrl,
                    'facePhotoUrl' : facePhotoUrl
                };
                $.ajax({
                    type : "POST",
                    url : "/demo/person/insertPerson",
                    dataType : "json",
                    data : data,
                    success : function(result) {

                        alert(result.msg);
                        if (result.status == '0') {
                            $('#InsertModal').modal('hide');
                        }
                    },
                    error : function(XMLHttpRequest, textStatus, errorThrown) {
                        console.log(XMLHttpRequest.status+"--"+XMLHttpRequest.readyState+"--"+textStatus);
                        alert("失败");


                    }
                });
            });
            $("#q_personType").change(function(){
                if(this.value =='C'){
                    $("#q_company_con").show();

                }else{
                    $("#q_company_con").hide();
                }

            })

        });
    </script>
    <!--
    <script type="text/javascript">

        $(function() {


            $("#searchDept").click(function(){
                $.ajax({
                    type:"post",
                    url:"/dept/getDeptTreeViewByName",
                    data: {"descr":$("#searchDescr").val()},
                    dataType:"json",
                    success:function(data){
                        $('#getDeptTreePage').treeview({
                            data : data, // data is not optional
                            levels : 5,
                            showTags : true,
                            loadingIcon : "glyphicon glyphicon-minus",//懒加载过程中显示的沙漏字符图标
                            //lazyLoad : loaddata
                            //loaddata为点击懒加载节点目录时，运行的函数名称，把后端的数据添加到这个节点下面
                        });
                        $('#getDeptTreePagePage').on('nodeSelected',function(event, data) {
                            window.deptId=data.id;
                            window.deptName=data.text;
                        });
                    },
                    error : function(XMLHttpRequest, textStatus, errorThrown) {
                        console.log(XMLHttpRequest.status+"&#45;&#45;"+XMLHttpRequest.readyState+"&#45;&#45;"+textStatus);
                        alert("失败");
                    }
                })


            })

            $.ajax({
                type:"post",
                url:"/dept/getDeptTreeView",
                data: {"lev":"1"},
                dataType:"json",
                success:function(data){
                    $('#getDeptTreePage').treeview({
                        data : data, // data is not optional
                        levels : 5,
                        showTags : true,
                        loadingIcon : "glyphicon glyphicon-minus"//懒加载过程中显示的沙漏字符图标
                        ,lazyLoad : loaddata
                        //loaddata为点击懒加载节点目录时，运行的函数名称，把后端的数据添加到这个节点下面
                    });
                    $('#getDeptTreePage').on('nodeSelected',function(event, data) {
                        //alert(event);
                        window.deptId=data.id;
                        window.deptName=data.text;
                        // alert(this.id);
                    });
                },
                error : function(XMLHttpRequest, textStatus, errorThrown) {
                    console.log(XMLHttpRequest.status+"&#45;&#45;"+XMLHttpRequest.readyState+"&#45;&#45;"+textStatus);
                    alert("失败");
                }
            })


        })

        function loaddata(node, func) {//这个技巧真高，即能得到节点数据，又能把节点下级的数据通过函数发回去
            //alert(node.id);
            //alert(func);
            $.ajax({
                type:"post",
                url:"/dept/getSonDeptTreeView",
                data: {"deptId":node.id},
                success:function(data){
                    func(data);
                }
            });

            //$("#getDeptTreePage").treeview("addNode", [singleNode,node]);这一句和上面一句等同
        }
    </script>-->
</head>

<body class="hold-transition skin-blue sidebar-mini">



<!--<div class="box" id="dept_div" style="width: 280px;float: left">
    <div style="width: 280px; height: 60px;">
        <div class="col-lg-6">
            <div class="input-group">
                <input id="searchDescr" type="text"
                       class="form-control panel-search-text"
                       placeholder="搜索部门"
                       style="width: 200px; margin-left: -15px;"> <span
                    class="input-group-btn">
											<button id="searchDept" class="btn btn-default" type="button">搜索部门</button>

										</span>
            </div>
        </div>
    </div>
    <div id="getDeptTreePage" style="width: 280px; height: 780px; overflow: auto;"></div>

</div>-->
<div class="box" id="person_div" style="float: left;width: 82%">

    <div class="panel-query2">
        <div class="col-xs-3">
            <label>工号:<input type="text" class="form-control"
                             id="q_emplid"></label>
        </div>
        <div class="col-xs-3">
            <label>姓名:<input type="text" class="form-control"
                             id="q_name"></label>
        </div>
        <div class="col-xs-3">
            <label>证件号:<input type="text" class="form-control"
                              id="q_nationalId"></label>
        </div>
        <div class="col-xs-3">
            <label>卡号:<input type="text" class="form-control"
                             id="q_cardno"></label>
        </div>

        <div class="col-xs-3">
            <label>人员类型 <select class="form-control"
                                id="q_personType">
            </select>

            </label>
        </div>
        <div class="col-xs-3" id="q_company_con" style="display: none">
            <label>施工商所在公司:<input type="text" class="form-control"
                                  id="q_company"></label>
        </div>
        <div class="col-xs-3 btnCol">
            <button type="button" class="btn btn-primary queryData">查询</button>
        </div>
    </div>
    <!-- /.box-header -->
    <div class="box-body">

        <!-- 点击事件触发模态框 -->
        <div id="toolbar">
            <button id="remove" class="btn btn-primary" disabled style="display: none">
                <i class="glyphicon glyphicon-remove"></i> 批量删除
            </button>
            <button id="btn_insert" class="btn btn-primary"
                    data-toggle="modal" data-target="#InsertModal">
                <i class="glyphicon glyphicon-plus"></i> 新增
            </button>
            <button id="btn_exportFace" class="btn btn-primary" style="width: 150px;"
                    data-toggle="modal" data-target="#ExportFaceModal">
                <i class="glyphicon glyphicon-plus"></i> 导出人脸照片
            </button>
        </div>

        <!-- 模态框（Modal） -->
        <div class="modal fade" id="InsertModal" tabindex="-1"
             data-backdrop="static" role="dialog"
             aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"
                                aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="myModalLabel">添加新人员</h4>
                    </div>
                    <div class="box-body">
                        <div class="box-body-Detail">
                            <div class="form-group">
                                <label>工号</label> <input type="text" id="i_emplid"
                                                         class="form-control" required="required" min="6"
                                                         maxlength="10" placeholder="必填项">
                            </div>
                            <div class="form-group">
                                <label>姓名</label> <input type="text" id="i_name"
                                                         class="form-control" required="required" min="1"
                                                         maxlength="18" placeholder="必填项">
                            </div>


                            <div class="form-group">
                                <label>性别</label> <select id="i_sex" class="form-control">
                            </select>
                            </div>


                            <div class="form-group">
                                <label>主要证件号</label> <input type="text" id="i_nationalId"
                                                            class="form-control" placeholder="">
                            </div>

                            <div>
                                <label>选择部门</label> <input type="hidden" id="objectType">
                                <div class="div-getData">
                                    <input type="text" class="form-control"
                                           readonly="readonly" id="i_deptid"> <label
                                        class="btn btn-default show_dept">查询可选部门</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>国籍</label> <input type="text" id="i_birthcountry"
                                                         class="form-control" maxlength="3" placeholder="">
                            </div>

                            <div class="form-group">
                                <label>出生日期</label> <input type="date" id="i_birthdate"
                                                           class="form-control" placeholder="">
                            </div>
                            <div class="form-group">
                                <label>国籍描述</label> <input type="text" id="i_descr1"
                                                           class="form-control" placeholder="">
                            </div>


                            <div class="form-group">
                                <label>手机号</label> <input type="text" id="i_phone"
                                                          class="form-control" placeholder="">
                            </div>

                            <div class="form-group">
                                <label>公司邮箱</label> <input type="text" id="i_emailAddr"
                                                           class="form-control" placeholder="">
                            </div>

                            <div class="form-group">
                                <label>人员类型</label> <select id="i_personType"
                                                            class="form-control">
                            </select>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default"
                                    data-dismiss="modal">关闭</button>
                            <input type="button" class="btn btn-primary insertData"
                                   value="保存">
                        </div>
                    </div>

                </div>


            </div>


        </div>
        <div class="modal fade" id="CardAndFaceInfo" tabindex="-1"
             role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"
                                aria-hidden="true">&times;</button>
                        <h4 class="modal-title">人脸和卡号管理</h4>
                    </div>
                    <div class="box-body">
                        <div class="box-body-Detail">
                            <div class="form-group">
                                <label>当前员工:</label> <input type="hidden" id="cp_personId">
                                <input type="text" id="cp_name" class="form-control"
                                       readonly="readonly">
                            </div>
                            <div class="form-group" style="margin: 10px;">
                                <input type="button"
                                       class="btn btn-primary insertFaceModel" value="添加人脸">
                                <input type="button" class="btn btn-danger deleteFaceModel"
                                       value="删除人脸">
                            </div>
                            <div class="form-group">
                                <label>人脸Id:</label> <input id="cp_faceId" type="text"
                                                            readonly="readonly" class="form-control">

                            </div>
                            <div class="form-group" style="margin: 10px;">

                                <input type="button"
                                       class="btn btn-primary insertCardModel" value="添加卡号">
                                <input type="button"
                                       class="btn btn-warning updateCardModel" value="修改卡号">
                                <input type="button" class="btn btn-danger deleteCardModel"
                                       value="删除卡号">
                            </div>
                            <div class="form-group">
                                <label>卡号:</label> <input type="hidden" id="cp_oldcardNo"
                                                          class="form-control" required="required"> <input
                                    type="text" id="cp_newcardNo" class="form-control"
                                    required="required">
                            </div>

                        </div>
                    </div>

                </div>
                <script type="text/javascript">
                    $(function() {
                        $(".insertFaceModel").click(function() {
                            $("#face_personId").val($("#cp_personId").val());
                            $('#InsertFace').modal('show');
                        })
                        $(".updateFaceModel").click(function() {
                            $.ajax({
                                url : "/demo/person/updateFace",
                                type : "POST",
                                dataType : "json",
                                data : {
                                    'personId' : $("#cp_personId").val(),
                                    'faceData' : $("#cp_faceData").val()
                                },
                                success : function(result) {

                                    alert(result.msg);

                                },
                                error : function(XMLHttpRequest, textStatus, errorThrown) {
                                    console.log(XMLHttpRequest.status+"--"+XMLHttpRequest.readyState+"--"+textStatus);
                                    alert("失败");
                                }
                            });
                        })
                        $(".deleteFaceModel").click(function() {
                            if (confirm("删除是不可恢复的，你确认要删除吗？")) {
                                $.ajax({
                                    url : "/demo/person/delFace",
                                    type : "POST",
                                    dataType : "json",
                                    data : {
                                        'personId' : $("#cp_personId").val()
                                    },
                                    success : function(result) {


                                        alert(result.msg);
                                        if (result.status == "0") {
                                            $("#cp_faceId").val("");
                                        }

                                    },
                                    error : function(XMLHttpRequest, textStatus, errorThrown) {
                                        console.log(XMLHttpRequest.status+"--"+XMLHttpRequest.readyState+"--"+textStatus);
                                        alert("失败");
                                    }
                                });
                            }
                        })
                        $(".insertCardModel").click(function() {
                            $("#card_synIndex").val($("#cp_personId").val());
                            $('#InsertCard').modal('show');
                        })
                        $('#InsertCard').on('hide.bs.modal', function(e) {
                            $("#InsertCard input").val("");

                        });
                        $('#InsertFace').on('hide.bs.modal', function(e) {
                            $("#InsertFace input").val("");

                        });
                        $(".updateCardModel").click(function() {
                            $.ajax({
                                url : "/demo/person/updateCard",
                                type : "POST",
                                dataType : "json",
                                data : {
                                    'personId' : $("#cp_personId").val(),
                                    'oldCardNo' : $("#cp_oldcardNo").val(),
                                    'newCardNo' : $("#cp_newcardNo").val()
                                },
                                success : function(result) {
                                    if(result.code==0){
                                        $("#cp_oldcardNo").val($("#cp_newcardNo").val());
                                    }
                                    alert(result.msg);

                                },
                                error : function(XMLHttpRequest, textStatus, errorThrown) {
                                    console.log(XMLHttpRequest.status+"--"+XMLHttpRequest.readyState+"--"+textStatus);
                                    alert("失败");
                                }
                            });
                        })
                        $(".deleteCardModel").click(function() {
                            if (confirm("删除是不可恢复的，你确认要删除吗？")) {
                                $.ajax({
                                    url : "/demo/person/deleteCard",
                                    type : "POST",
                                    dataType : "json",
                                    data : {
                                        'personId' : $("#cp_personId").val(),
                                        'cardNo' : $("#cp_oldcardNo").val()
                                    },
                                    success : function(result) {
                                        $("#cp_oldcardNo").val("");
                                        $("#cp_newcardNo").val("");

                                        alert(result.msg);

                                    },
                                    error : function(XMLHttpRequest, textStatus, errorThrown) {
                                        console.log(XMLHttpRequest.status+"--"+XMLHttpRequest.readyState+"--"+textStatus);
                                        alert("失败");
                                    }
                                });
                            }
                        })

                    })
                </script>
            </div>
        </div>
        <div class="modal fade" id="InsertCard" tabindex="-1"
             role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"
                                aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="myModalLabel">添加卡号信息</h4>
                    </div>
                    <div class="box-body">
                        <div class="box-body-Detail">
                            <div class="form-group">
                                <label>有效开始时间:</label> <input type="hidden"
                                                              id="card_synIndex"> <input type="date"
                                                                                         id="startDate" class="form-control" required="required">
                            </div>
                            <div class="form-group">
                                <label>有效结束时间:</label> <input type="date" id="endDate"
                                                              class="form-control" required="required">
                            </div>
                            <div class="form-group">
                                <label>卡号:</label> <input type="text" id="cardNo"
                                                          class="form-control" required="required">
                            </div>
                            <div class="form-group">
                                <label>卡片类型:</label> <select id="cardType"
                                                             class="form-control">
                            </select>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default"
                                    data-dismiss="modal">关闭</button>
                            <button type="button" class="btn btn-primary insertCard">保存</button>

                        </div>
                    </div>

                </div>

            </div>
        </div>

        <div class="modal fade" id="InsertFace" tabindex="-1"
             role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"
                                aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="myModalLabel">添加人脸信息</h4>
                    </div>
                    <div class="box-body">
                        <div class="box-body-Detail">

                            <div class="form-group">
                                <label>人脸图片类型:</label> <select class="form-control"
                                                               id="imageType">

                            </select>
                            </div>
                            <div class="form-group">
                                <label>人脸url地址:</label> <input type="hidden"
                                                               id="face_personId"> <input id="faceData"
                                                                                          type="text" class="form-control">

                            </div>
                            <div class="form-group" style="height: 400px;border: 1px solid red">
                                <img alt="" src="" style="height: 400px;width: 400px">
                            </div>

                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default"
                                    data-dismiss="modal">关闭</button>
                            <button type="button" class="btn btn-primary insertFace">保存</button>

                        </div>
                    </div>

                </div>

            </div>
        </div>

        <!-- 修改的模态框 -->
        <div class="modal fade" id="UpdateModal" tabindex="-1"
             role="dialog" aria-labelledby="myModalLabel2" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"
                                aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="myModalLabel2">修改人员</h4>
                    </div>
                    <div class="modal-body">
                        <div class="box-body">
                            <div class="box-body-Detail">
                                <div class="form-group">
                                    <label>工号</label> <input type="text" id="emplid"
                                                             class="form-control" readonly="readonly" min="6"
                                                             maxlength="18" placeholder="必填项,,1-11个字符"> <input
                                        type="hidden" id="personId">
                                </div>
                                <div class="form-group">
                                    <label>姓名</label> <input type="text" id="name"
                                                             class="form-control" required="required" min="1"
                                                             maxlength="18" placeholder="必填项,,1-50个字符">
                                </div>


                                <div class="form-group">
                                    <label>性别</label> <select id="sex" class="form-control">
                                </select>
                                </div>


                                <div class="form-group">
                                    <label>主要证件号</label> <input type="text" id="nationalId"
                                                                class="form-control" placeholder="">
                                </div>

                                <div>
                                    <label>选择部门</label> <input type="hidden" id="objectType">
                                    <div class="div-getData">
                                        <input type="text" class="form-control"
                                               readonly="readonly" id="deptid"> <label
                                            class="btn btn-default show_dept">查询可选部门</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>国籍</label> <input type="text" id="birthcountry"
                                                             class="form-control" maxlength="3" placeholder="">
                                </div>

                                <div class="form-group">
                                    <label>出生日期</label> <input type="date" id="birthdate"
                                                               class="form-control" placeholder="">
                                </div>
                                <div class="form-group">
                                    <label>国籍描述</label> <input type="text" id="descr1"
                                                               class="form-control" placeholder="">
                                </div>


                                <div class="form-group">
                                    <label>手机号</label> <input type="text" id="phone"
                                                              class="form-control" placeholder="">
                                </div>

                                <div class="form-group">
                                    <label>公司邮箱</label> <input type="text" id="emailAddr"
                                                               class="form-control" placeholder="">
                                </div>

                                <div class="form-group">
                                    <label>人员类型</label> <select id="personType"
                                                                class="form-control">
                                </select>
                                </div>

                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default"
                                        data-dismiss="modal">关闭</button>
                                <input id="" type="button" class="btn btn-primary saveData"
                                       value="提交更改">
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>


        <table id="table" data-toolbar="#toolbar"  data-sort-stable="true"
               data-show-refresh="true" data-search="false" data-striped="true"
               data-show-toggle="true" data-show-fullscreen="true"
               data-show-columns="true"
               data-show-export="true" data-detail-formatter="detailFormatter"
               data-minimum-count-columns="2"
               data-show-pagination-switch="true" data-pagination="true"
               data-id-field="emplid" data-page-list="[20, 50, 100]"
               data-show-footer="false"
               data-url="/demo/person/getPersonListPage"
               data-response-handler="responseHandler">
        </table>

        <script type="text/javascript">
            var $table = $('#table')
            var $remove = $('#remove')
            var selections = []

            $(".dropdown-toggle").dropdown()

            function getIdSelections() {
                return $.map($table.bootstrapTable('getSelections'), function(row) {
                    return row.emplid
                })
            }
            function getSynIndexIdSelections() {
                return $.map($table.bootstrapTable('getSelections'), function(row) {
                    return row.personId
                })
            }

            function responseHandler(res) {
                $.each(res.rows, function(i, row) {
                    row.state = $.inArray(row.emplid, selections) !== -1
                })
                return res
            }

            function detailFormatter(index, row) {
                var html = []
                $.each(row, function(key, value) {
                    html.push('<p><b>' + key + ':</b> ' + value + '</p>')
                })
                return html.join('')
            }

            function changeTypeFormat(cellval) {

                if (window.DBpersonType[cellval] == null) {
                    return "未知";
                }
                return window.DBpersonType[cellval];

            }

            function operateFormatter(value, row, index) {
                if(row.cardNo==null || row.personId==null){
                    return [ '<a class="complie" href="javascript:void(0)" title="编辑">', '<i class="fa fa-list-alt"></i>', '</a>',
                        '<a class="faceAndCardManage" href="javascript:void(0)" title="卡号和人脸管理">', '<i class="fa fa-credit-card"> </i>', '</a>',
                    ].join('');
                }
                return [ '<a class="complie" href="javascript:void(0)" title="编辑">', '<i class="fa fa-list-alt"></i>', '</a>',
                    '<a class="faceAndCardManage" href="javascript:void(0)" title="卡号和人脸管理">', '<i class="fa fa-credit-card"> </i>', '</a>',
                    '<a class="downloadAuth" href="javascript:void(0)" title="权限下载">', '<i class="fa fa-arrow-down"> </i>', '</a>'
                    /* ,
                    '<a class="remove" href="javascript:void(0)" title="删除">', '<i class="fa fa-trash"> </i>', '</a>'  */].join('')
            }

            window.operateEvents = {
                'click .complie' : function(e, value, row, index) {
                    var data = {
                        'emplid' : row.emplid
                    };
                    $.ajax({
                        url : "/demo/person/ToUpdatePage",
                        async : true,
                        type : "POST",
                        data : {
                            'emplid' : row.emplid
                        },
                        dataType : "json",
                        success : function(data) {
                            var array = data;
                            var oldMan = $.map(array, function(value, key) {
                                var person = value.person;
                                for ( var i in person) {//用javascript的for/in循环遍历对象的属性
                                    $("#" + i).val(person[i]);
                                }
                            })
                            $('#UpdateModal').modal('show');
                        },
                        error : function(XMLHttpRequest, textStatus, errorThrown) {
                            console.log(XMLHttpRequest.status+"--"+XMLHttpRequest.readyState+"--"+textStatus);
                            alert("失败");
                        },
                    });
                    //JSON.stringify(row)
                },
                'click .faceAndCardManage' : function(e, value, row, index) {

                    $.ajax({
                        url : "/demo/person/getPersonDeptAndFaceByEmplid",
                        type : "POST",
                        dataType : "json",
                        data : {
                            'emplid' : row.emplid
                        },
                        success : function(result) {
                            for (var i in result) {
                                $("#pam_" + i).val(result[i]);
                            }
                            if(result.photoData !=null && result.photoData!=''){
                                $("#pam_photoData").attr("src","data:image/jpeg;base64,"+result.photoData);
                            }else{
                                var photo_data="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";
                                $("#pam_photoData").attr("src","data:image/jpeg;base64,"+photo_data);
                            }
                            $("#pam_old_cardNo").val($("#pam_cardNo").val());
                            getLeftGroupList(result.emplid);
                            getRightGroupList();
                            $("#personAuthManageModal").modal('show');
                        },
                        error : function(XMLHttpRequest, textStatus, errorThrown) {
                            console.log(XMLHttpRequest.status+"--"+XMLHttpRequest.readyState+"--"+textStatus);
                            alert("失败");
                        }
                    });
                    /* $("#cp_personId").val(row.personId);
                    $("#cp_name").val(row.name);
                    //$("#cp_oldfaceData").val(row.photosynIndex);
                    $("#cp_faceId").val(row.photoSynIndex);
                    $("#cp_oldcardNo").val(row.cardNo);
                    $("#cp_newcardNo").val(row.cardNo);

                    $('#CardAndFaceInfo').modal('show'); */
                    //JSON.stringify(row)
                },
                'click .addCard' : function(e, value, row, index) {

                    $("#card_synIndex").val(row.personId);

                    $('#InsertCard').modal('show');
                    //JSON.stringify(row)
                },
                'click .addFace' : function(e, value, row, index) {

                    $("#face_personId").val(row.personId);
                    $('#InsertFace').modal('show');
                },
                'click .downloadAuth' : function(e, value, row, index) {

                    if (confirm("权限是否重新下载？")) {
                        //显示加载框
                        $("#downloadModel").show();
                        $.ajax({
                            url : "/demo/person/DownloadAuthByPerson",
                            type : "POST",
                            dataType : "json",
                            data : {
                                'emplid' : row.emplid
                            },
                            success : function(result) {

                                alert(result.msg);
                                if (result.code == '0') {
                                    //关闭加载框
                                }
                                $("#downloadModel").hide();
                            },
                            error : function(XMLHttpRequest, textStatus, errorThrown) {
                                console.log(XMLHttpRequest.status+"--"+XMLHttpRequest.readyState+"--"+textStatus);
                                alert("失败");
                            }
                        });


                    }
                },
                'click .remove' : function(e, value, row, index) {
                    if (confirm("删除是不可恢复的，你确认要删除吗？")) {
                        $.ajax({
                            url : "/demo/person/deletePerson",
                            type : "POST",
                            dataType : "json",
                            data : {
                                'emplid' : row.emplid,
                                'personId' : row.personId
                            },
                            success : function(result) {

                                alert(result.msg);
                                if (result.status == '0') {
                                    $("#table").bootstrapTable('refresh');
                                }
                            },
                            error : function(XMLHttpRequest, textStatus, errorThrown) {
                                console.log(XMLHttpRequest.status+"--"+XMLHttpRequest.readyState+"--"+textStatus);
                                alert("失败");
                            }
                        });

                    }
                }

            }

            function totalTextFormatter(data) {
                return 'Total'
            }

            function totalNameFormatter(data) {
                return data.length
            }

            function totalPriceFormatter(data) {
                var field = this.field
                return '$' + data.map(function(row) {
                    return +row[field].substring(1)
                }).reduce(function(sum, i) {
                    return sum + i
                }, 0)
            }
            function paramsMatter(value, row, index) {
                var values = row.nationalId;
                var span=document.createElement('span');
                span.setAttribute('title',values);
                span.innerHTML = row.nationalId;
                return span.outerHTML;
            }

            function formatTableUnit(value, row, index) {
                return {
                    css: {
                        "white-space": 'nowrap',
                        "text-overflow": 'ellipsis',
                        "overflow": 'hidden'
                    }
                }
            }
            function initTable() {
                $table.bootstrapTable('destroy').bootstrapTable({
                    locale : $('#locale').val(),
                    exportDataType : "all",	 //basic', 'all', 'selected' 当前页,全部,选中
                    searchable : true,
                    //detailView : true,
                    sidePagination: "server",
                    queryParams : queryParams,
                    method : 'post',
                    pageSize: 20,
                    contentType : "application/x-www-form-urlencoded; charset=UTF-8",
                    columns : [ [ {
                        field : 'status',
                        checkbox : true,
                        align : 'center',
                        valign : 'middle',
                        visible:false,
                    }, {
                        title : '工号',
                        field : 'emplid',
                        align : 'center',
                        valign : 'middle',
                        footerFormatter : totalTextFormatter
                    }, {
                        field : 'name',
                        title : '姓名',
                        align : 'center',
                        valign : 'middle',
                        footerFormatter : totalNameFormatter,
                    }, {
                        field : 'birthdate',
                        title : '出生日期',
                        sortable : true,
                        align : 'center',
                        visible:false,
                        footerFormatter : totalPriceFormatter
                    }, {
                        field : 'birthcountry',
                        title : '国籍',
                        align : 'center',
                        visible:false,
                        footerFormatter : totalPriceFormatter
                    }, {
                        field : 'descr1',
                        title : '国籍描述',
                        align : 'center',
                        visible:false,
                        footerFormatter : totalPriceFormatter
                    }, {
                        field : 'nationalId',
                        title : '主要证件号',
                        align : 'center',
                        width: '150px',
                        cellStyle:formatTableUnit,
                        formatter:paramsMatter
                    },{
                        field : 'descr',
                        title : '所在部门',
                        align : 'center',
                        width: '150px',
                        cellStyle:formatTableUnit,
                        formatter:function(value, row, index) {
                            var values = row.descrPath;
                            var span=document.createElement('span');
                            span.setAttribute('title',values);
                            span.innerHTML = row.descr;
                            return span.outerHTML;
                        }
                    }, {
                        field : 'phone',
                        title : '手机号',
                        align : 'center',
                        visible:false,
                        footerFormatter : totalPriceFormatter
                    }, {
                        field : 'emailAddr',
                        title : '公司邮箱',
                        align : 'center',
                        visible:false,
                        footerFormatter : totalPriceFormatter
                    },{
                        field : 'tmRank',
                        title : '职级',
                        align : 'center',
                        sortable : true,
                        visible:false,
                        footerFormatter : totalPriceFormatter
                    }, {
                        field : 'personType',
                        title : '人员类型',
                        align : 'center',
                        formatter : function(value, row, index) {
                            return changeTypeFormat(value)
                        }
                    }, {
                        field : 'hrStatus',
                        title : '状态',
                        align : 'center',
                        formatter : function(value, row, index) {
                            if(row.hrStatus=='I'){
                                return '离职';
                            }else if(row.hrStatus=='A'){
                                return '在职';
                            }else{
                                return '其他';
                            }
                        }
                    },{
                        field : 'cardNo',
                        title : '卡号',
                        align : 'center',
                        footerFormatter : totalPriceFormatter
                    },{
                        field : 'faceId',
                        title : '人脸',
                        align : 'center',
                        formatter : function(value, row, index) {
                            if(row.faceId==null || row.faceId.trim()==''){
                                return '无';
                            }else  {
                                return '有';
                            }
                        }
                    }, {
                        field : 'operate',
                        title : 'Item Operate',
                        align : 'center',
                        events : window.operateEvents,
                        formatter : operateFormatter
                    } ] ], onLoadError: function () {
                        exit_acms();
                    }
                })
            }


            $table.on('check.bs.table uncheck.bs.table ' + 'check-all.bs.table uncheck-all.bs.table', function() {
                $remove.prop('disabled', !$table.bootstrapTable('getSelections').length)

                // save your data, here just save the current page
                selections = getIdSelections()
                // push or splice the selections if you want to save all data selections
            })

            $remove.click(function() {
                var ids = getIdSelections().join(',');
                var personIds = getSynIndexIdSelections().join(',');
                if (confirm("批量删除是不可恢复的，你确认要删除吗？")) {
                    $.ajax({
                        url : "/demo/person/deletePersons",
                        async : true,
                        type : "POST",
                        dataType : "json",
                        data : {
                            'emplids' : ids,
                            'personIds' : personIds
                        },
                        success : function(result) {

                            alert(result.msg);
                            if (result.status == '0') {
                                $("#table").bootstrapTable('refresh');
                            }
                        },
                        error : function(XMLHttpRequest, textStatus, errorThrown) {
                            console.log(XMLHttpRequest.status+"--"+XMLHttpRequest.readyState+"--"+textStatus);
                            alert("失败");

                        }
                    });
                }
            })

            //得到查询的参数

            var paramsCode=0;
            function queryParams(params) {

                /*var deptId="";
                if(paramsCode!=0){
                    var dept=$('#getDeptTreePage').treeview('getSelected')[0];
                    if(dept!=null ){
                        deptId=dept.id;
                    }
                }else{
                    paramsCode=1;
                }
                var exportCode =1;
                if(params.offset==null && params.limit==null){
                    exportCode=2;
                }*/


                var temp = { //这里的键的名字和控制器的变量名必须一直，这边改动，控制器也需要改成一样的
                    // limit: params.limit,   //页面大小
                    emplid : $("#q_emplid").val(),
                    name : $("#q_name").val(),
                    cardNo : $("#q_cardno").val(),
                    personType : $("#q_personType").val(),
                    descr1 : $("#q_company").val(),
                    nationalId : $("#q_nationalId").val(),
                    //deptid : deptId,
                    offset: params.offset,
                    limit: params.limit,
                    sort:params.sort,
                    order:params.order
                    //exportCode:exportCode

                };
                return temp;
            };

            $(function() {

                initTable()

                $('.queryData').click(initTable)

            })
        </script>

    </div>
</div>

<input type="hidden" id="requestJsp" value="personList">

</body>
</html>
